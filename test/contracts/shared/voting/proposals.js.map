{
  "version": 3,
  "sources": ["../../../../node_modules/@sbp/sbp/dist/module.mjs", "../../../../frontend/common/common.js", "../../../../frontend/common/vSafeHtml.js", "../../../../frontend/model/contracts/shared/giLodash.js", "../../../../frontend/common/translations.js", "../../../../frontend/common/stringTemplate.js", "../../../../frontend/model/contracts/misc/flowTyper.js", "../../../../frontend/model/contracts/shared/time.js", "../../../../frontend/model/contracts/shared/constants.js", "../../../../frontend/model/contracts/shared/voting/rules.js", "../../../../frontend/model/contracts/shared/voting/proposals.js"],
  "sourcesContent": ["// \n\n'use strict'\n\n\nconst selectors = {}\nconst domains = {}\nconst globalFilters = []\nconst domainFilters = {}\nconst selectorFilters = {}\nconst unsafeSelectors = {}\n\nconst DOMAIN_REGEX = /^[^/]+/\n\nfunction sbp (selector, ...data) {\n  const domain = domainFromSelector(selector)\n  if (!selectors[selector]) {\n    throw new Error(`SBP: selector not registered: ${selector}`)\n  }\n  // Filters can perform additional functions, and by returning `false` they\n  // can prevent the execution of a selector. Check the most specific filters first.\n  for (const filters of [selectorFilters[selector], domainFilters[domain], globalFilters]) {\n    if (filters) {\n      for (const filter of filters) {\n        if (filter(domain, selector, data) === false) return\n      }\n    }\n  }\n  return selectors[selector].call(domains[domain].state, ...data)\n}\n\nexport function domainFromSelector (selector) {\n  const domainLookup = DOMAIN_REGEX.exec(selector)\n  if (domainLookup === null) {\n    throw new Error(`SBP: selector missing domain: ${selector}`)\n  }\n  return domainLookup[0]\n}\n\nconst SBP_BASE_SELECTORS = {\n  'sbp/selectors/register': function (sels) {\n    const registered = []\n    for (const selector in sels) {\n      const domain = domainFromSelector(selector)\n      if (selectors[selector]) {\n        (console.warn || console.log)(`[SBP WARN]: not registering already registered selector: '${selector}'`)\n      } else if (typeof sels[selector] === 'function') {\n        if (unsafeSelectors[selector]) {\n          // important warning in case we loaded any malware beforehand and aren't expecting this\n          (console.warn || console.log)(`[SBP WARN]: registering unsafe selector: '${selector}' (remember to lock after overwriting)`)\n        }\n        const fn = selectors[selector] = sels[selector]\n        registered.push(selector)\n        // ensure each domain has a domain state associated with it\n        if (!domains[domain]) {\n          domains[domain] = { state: {} }\n        }\n        // call the special _init function immediately upon registering\n        if (selector === `${domain}/_init`) {\n          fn.call(domains[domain].state)\n        }\n      }\n    }\n    return registered\n  },\n  'sbp/selectors/unregister': function (sels) {\n    for (const selector of sels) {\n      if (!unsafeSelectors[selector]) {\n        throw new Error(`SBP: can't unregister locked selector: ${selector}`)\n      }\n      delete selectors[selector]\n    }\n  },\n  'sbp/selectors/overwrite': function (sels) {\n    sbp('sbp/selectors/unregister', Object.keys(sels))\n    return sbp('sbp/selectors/register', sels)\n  },\n  'sbp/selectors/unsafe': function (sels) {\n    for (const selector of sels) {\n      if (selectors[selector]) {\n        throw new Error('unsafe must be called before registering selector')\n      }\n      unsafeSelectors[selector] = true\n    }\n  },\n  'sbp/selectors/lock': function (sels) {\n    for (const selector of sels) {\n      delete unsafeSelectors[selector]\n    }\n  },\n  'sbp/selectors/fn': function (sel) {\n    return selectors[sel]\n  },\n  'sbp/filters/global/add': function (filter) {\n    globalFilters.push(filter)\n  },\n  'sbp/filters/domain/add': function (domain, filter) {\n    if (!domainFilters[domain]) domainFilters[domain] = []\n    domainFilters[domain].push(filter)\n  },\n  'sbp/filters/selector/add': function (selector, filter) {\n    if (!selectorFilters[selector]) selectorFilters[selector] = []\n    selectorFilters[selector].push(filter)\n  }\n}\n\nSBP_BASE_SELECTORS['sbp/selectors/register'](SBP_BASE_SELECTORS)\n\nexport default sbp\n", "'use strict'\n\n// This file allows us to deduplicate some code between the main app bundle and\n// the slim'd down contract bundles.\n// Any large shared dependencies between the contracts - that are unlikely to ever\n// change - go into this file. For example, we are using Vue between the frontend\n// and the contracts (for the Vue.set/Vue.delete functions), and those are unlikely\n// to ever change in their behavior. Therefore it's a perfect candidate to go in\n// this file, resulting a smaller overall bundle for the contract slim builds.\n// All other in-project code that's shared between the contracts should be\n// placed under 'frontend/model/contracts/shared/' and imported directly\n// from both the app and the contracts. This will result in some duplicated code being\n// loaded by the contracts (even the slim'd versions) and the main app, however,\n// it will ensure the safe and consistent operation of contracts, minimizing the\n// likelihood that there will ever be a conflict between their state and what the UI\n// expects the behavior to be.\n\n// EVERYTHING EXPORTED BY THIS FILE MUST ALWAYS AND ONLY BE IMPORTED\n// VIA \"/assets/js/common.js\"!\n// DO NOT CHANGE THE BEHAVIOR OF ANYTHING IMPORTED BY THIS FILE THAT AFFECTS THE\n// BEHAVIOR OF CONTRACTS IN ANY MEANINGFUL WAY!\n// Doing otherwise defeats the purpose of this file and could lead to bugs and conflicts!\n// You may *add* behavior, but never modify or remove it.\n\nexport { default as Vue } from 'vue'\nexport { default as L } from './translations.js'\nexport * from './translations.js'\nexport * from './errors.js'\nexport * as Errors from './errors.js'\n", "/*\n * Copyright GitLab B.V.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/*\n * This file is mainly a copy of the `safe-html.js` directive found in the\n * [gitlab-ui](https://gitlab.com/gitlab-org/gitlab-ui) project,\n * slightly modifed for linting purposes and to immediately register it via\n * `Vue.directive()` rather than exporting it, consistently with our other\n * custom Vue directives.\n */\n\nimport dompurify from 'dompurify'\nimport Vue from 'vue'\nimport { cloneDeep } from '~/frontend/model/contracts/shared/giLodash.js'\n\n// See https://github.com/cure53/DOMPurify#can-i-configure-dompurify\nexport const defaultConfig = {\n  ALLOWED_ATTR: ['class'],\n  ALLOWED_TAGS: ['b', 'br', 'em', 'i', 'p', 'small', 'span', 'strong', 'sub', 'sup', 'u'],\n  // This option was in the original file.\n  RETURN_DOM_FRAGMENT: true\n}\n\nconst transform = (el, binding) => {\n  if (binding.oldValue !== binding.value) {\n    let config = defaultConfig\n    if (binding.arg === 'a') {\n      config = cloneDeep(config)\n      config.ALLOWED_ATTR.push('href', 'target')\n      config.ALLOWED_TAGS.push('a')\n    }\n    el.textContent = ''\n    el.appendChild(dompurify.sanitize(binding.value, config))\n  }\n}\n\n/*\n * Register a global custom directive called `v-safe-html`.\n *\n * Please use this instead of `v-html` everywhere user input is expected,\n *   in order to avoid XSS vulnerabilities.\n *\n * See https://github.com/okTurtles/group-income/issues/975\n */\n\nVue.directive('safe-html', {\n  bind: transform,\n  update: transform\n})\n", "// manually implemented lodash functions are better than even:\n// https://github.com/lodash/babel-plugin-lodash\n// additional tiny versions of lodash functions are available in VueScript2\n\nexport function mapValues (obj, fn, o = {}) {\n  for (const key in obj) { o[key] = fn(obj[key]) }\n  return o\n}\n\nexport function mapObject (obj, fn) {\n  return Object.fromEntries(Object.entries(obj).map(fn))\n}\n\nexport function pick (o, props) {\n  const x = {}\n  for (const k of props) { x[k] = o[k] }\n  return x\n}\n\nexport function pickWhere (o, where) {\n  const x = {}\n  for (const k in o) {\n    if (where(o[k])) { x[k] = o[k] }\n  }\n  return x\n}\n\nexport function choose (array, indices) {\n  const x = []\n  for (const idx of indices) { x.push(array[idx]) }\n  return x\n}\n\nexport function omit (o, props) {\n  const x = {}\n  for (const k in o) {\n    if (!props.includes(k)) {\n      x[k] = o[k]\n    }\n  }\n  return x\n}\n\nexport function cloneDeep (obj) {\n  return JSON.parse(JSON.stringify(obj))\n}\n\nfunction isMergeableObject (val) {\n  const nonNullObject = val && typeof val === 'object'\n  // $FlowFixMe\n  return nonNullObject && Object.prototype.toString.call(val) !== '[object RegExp]' && Object.prototype.toString.call(val) !== '[object Date]'\n}\n\nexport function merge (obj, src) {\n  for (const key in src) {\n    const clone = isMergeableObject(src[key]) ? cloneDeep(src[key]) : undefined\n    if (clone && isMergeableObject(obj[key])) {\n      merge(obj[key], clone)\n      continue\n    }\n    obj[key] = clone || src[key]\n  }\n  return obj\n}\n\nexport function delay (msec) {\n  return new Promise((resolve, reject) => {\n    setTimeout(resolve, msec)\n  })\n}\n\nexport function randomBytes (length) {\n  // $FlowIssue crypto support: https://github.com/facebook/flow/issues/5019\n  return crypto.getRandomValues(new Uint8Array(length))\n}\n\nexport function randomHexString (length) {\n  return Array.from(randomBytes(length), byte => (byte % 16).toString(16)).join('')\n}\n\nexport function randomIntFromRange (min, max) {\n  return Math.floor(Math.random() * (max - min + 1) + min)\n}\n\nexport function randomFromArray (arr) {\n  return arr[Math.floor(Math.random() * arr.length)]\n}\n\nexport function flatten (arr) {\n  let flat = []\n  for (let i = 0; i < arr.length; i++) {\n    if (Array.isArray(arr[i])) {\n      flat = flat.concat(arr[i])\n    } else {\n      flat.push(arr[i])\n    }\n  }\n  return flat\n}\n\nexport function zip () {\n  // $FlowFixMe\n  const arr = Array.prototype.slice.call(arguments)\n  const zipped = []\n  let max = 0\n  arr.forEach((current) => (max = Math.max(max, current.length)))\n  for (const current of arr) {\n    for (let i = 0; i < max; i++) {\n      zipped[i] = zipped[i] || []\n      zipped[i].push(current[i])\n    }\n  }\n  return zipped\n}\n\nexport function uniq (array) {\n  return Array.from(new Set(array))\n}\n\nexport function union (...arrays) {\n  // $FlowFixMe\n  return uniq([].concat.apply([], arrays))\n}\n\nexport function intersection (a1, ...arrays) {\n  return uniq(a1).filter(v1 => arrays.every(v2 => v2.indexOf(v1) >= 0))\n}\n\nexport function difference (a1, ...arrays) {\n  // $FlowFixMe\n  const a2 = [].concat.apply([], arrays)\n  return a1.filter(v => a2.indexOf(v) === -1)\n}\n\nexport function deepEqualJSONType (a, b) {\n  if (a === b) return true\n  if (a === null || b === null || typeof (a) !== typeof (b)) return false\n  if (typeof a !== 'object') return a === b\n  if (Array.isArray(a)) {\n    if (a.length !== b.length) return false\n  } else if (a.constructor.name !== 'Object') {\n    throw new Error(`not JSON type: ${a}`)\n  }\n  for (const key in a) {\n    if (!deepEqualJSONType(a[key], b[key])) return false\n  }\n  return true\n}\n\n/**\n * Modified version of: https://github.com/component/debounce/blob/master/index.js\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing. The function also has a property 'clear'\n * that is a function which will clear the timer to prevent previously scheduled executions.\n *\n * @source underscore.js\n * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\n * @param {Function} function to wrap\n * @param {Number} timeout in ms (`100`)\n * @param {Boolean} whether to execute at the beginning (`false`)\n * @api public\n */\nexport function debounce (func, wait, immediate) {\n  let timeout, args, context, timestamp, result\n  if (wait == null) wait = 100\n\n  function later () {\n    const last = Date.now() - timestamp\n\n    if (last < wait && last >= 0) {\n      timeout = setTimeout(later, wait - last)\n    } else {\n      timeout = null\n      if (!immediate) {\n        result = func.apply(context, args)\n        context = args = null\n      }\n    }\n  }\n\n  const debounced = function () {\n    context = this\n    args = arguments\n    timestamp = Date.now()\n    const callNow = immediate && !timeout\n    if (!timeout) timeout = setTimeout(later, wait)\n    if (callNow) {\n      result = func.apply(context, args)\n      context = args = null\n    }\n\n    return result\n  }\n\n  debounced.clear = function () {\n    if (timeout) {\n      clearTimeout(timeout)\n      timeout = null\n    }\n  }\n\n  debounced.flush = function () {\n    if (timeout) {\n      result = func.apply(context, args)\n      context = args = null\n      clearTimeout(timeout)\n      timeout = null\n    }\n  }\n\n  return debounced\n}\n", "'use strict'\n\n// since this file is loaded by common.js, we avoid circular imports and directly import\nimport sbp from '@sbp/sbp'\nimport { defaultConfig as defaultDompurifyConfig } from './vSafeHtml.js'\nimport dompurify from 'dompurify'\nimport Vue from 'vue'\nimport template from './stringTemplate.js'\n\nVue.prototype.L = L\nVue.prototype.LTags = LTags\n\nconst defaultLanguage = 'en-US'\nconst defaultLanguageCode = 'en'\nconst defaultTranslationTable                       = {}\n\n/**\n * Allow 'href' and 'target' attributes to avoid breaking our hyperlinks,\n * but keep sanitizing their values.\n * See https://github.com/cure53/DOMPurify#can-i-configure-dompurify\n */\nconst dompurifyConfig = {\n  ...defaultDompurifyConfig,\n  ALLOWED_ATTR: ['class', 'href', 'rel', 'target'],\n  ALLOWED_TAGS: ['a', 'b', 'br', 'button', 'em', 'i', 'p', 'small', 'span', 'strong', 'sub', 'sup', 'u'],\n  RETURN_DOM_FRAGMENT: false\n}\n\nlet currentLanguage = defaultLanguage\nlet currentLanguageCode = defaultLanguage.split('-')[0]\nlet currentTranslationTable = defaultTranslationTable\n\n/**\n * Loads the translation file corresponding to a given language.\n *\n * @param language - A BPC-47 language tag like the value\n * of `navigator.language`.\n *\n * Language tags must be compared in a case-insensitive way (\u00A72.1.1.).\n *\n * @see https://tools.ietf.org/rfc/bcp/bcp47.txt\n */\nsbp('sbp/selectors/register', {\n  'translations/init': async function init (language        )                {\n    // A language code is usually the first part of a language tag.\n    const [languageCode] = language.toLowerCase().split('-')\n\n    // No need to do anything if the requested language is already in use.\n    if (language.toLowerCase() === currentLanguage.toLowerCase()) return\n\n    // We can also return early if only the language codes match,\n    //   since we don't have culture-specific translations yet.\n    if (languageCode === currentLanguageCode) return\n\n    // Avoid fetching any ressource if the requested language is the default one.\n    if (languageCode === defaultLanguageCode) {\n      currentLanguage = defaultLanguage\n      currentLanguageCode = defaultLanguageCode\n      currentTranslationTable = defaultTranslationTable\n      return\n    }\n    try {\n      currentTranslationTable = (await sbp('backend/translations/get', language)) || defaultTranslationTable\n\n      // Only set `currentLanguage` if there was no error fetching the ressource.\n      currentLanguage = language\n      currentLanguageCode = languageCode\n    } catch (error) {\n      console.error(error)\n    }\n  }\n})\n\n/*\nExamples:\n\nSimple string:\n  i18n Hello world\n\nString with variables:\n  i18n(\n    :args='{ name: ourUsername }'\n  ) Hello {name}!\n\nString with HTML markup inside:\n  i18n(\n    :args='{ ...LTags(\"strong\", \"span\"), name: ourUsername }'\n  ) Hello {strong_}{name}{_strong}, today it's a {span_}nice day{_span}!\n  | or\n  i18n(\n    :args='{ ...LTags(\"span\"), name: \"<strong>${ourUsername}</strong>\" }'\n  ) Hello {name}, today it's a {span_}nice day{_span}!\n\nString with Vue components inside:\n  i18n(\n    compile\n    :args='{ r1: `<router-link class=\"link\" to=\"/login\">`, r2: \"</router-link>\"}'\n  ) Go to {r1}login{r2} page.\n\n## When to use LTags or write html as part of the key?\n- Use LTags when they wrap a variable and raw text. Example:\n\n  i18n(\n    :args='{ count: 5, ...LTags(\"strong\") }'\n  ) Invite {strong}{count} members{strong} to the party!\n\n- Write HTML when it wraps only the variable.\n-- That way translators don't need to worry about extra information.\n  i18n(\n    :args='{ count: \"<strong>5</strong>\" }'\n  ) Invite {count} members to the party!\n*/\n\nexport function LTags (...tags          )                  {\n  const o = {\n    'br_': '<br/>'\n  }\n  for (const tag of tags) {\n    o[`${tag}_`] = `<${tag}>`\n    o[`_${tag}`] = `</${tag}>`\n  }\n  return o\n}\n\nexport default function L (\n  key        ,\n  args                          \n)         {\n  return template(currentTranslationTable[key] || key, args)\n    // Avoid inopportune linebreaks before certain punctuations.\n    .replace(/\\s(?=[;:?!])/g, '&nbsp;')\n}\n\nexport function LError (error       )                       {\n  let url = `/app/dashboard?modal=UserSettingsModal&section=application-logs&errorMsg=${encodeURI(error.message)}`\n  if (!sbp('state/vuex/state').loggedIn) {\n    url = 'https://github.com/okTurtles/group-income/issues'\n  }\n  return {\n    reportError: L('\"{errorMsg}\". You can {a_}report the error{_a}.', {\n      errorMsg: error.message,\n      'a_': `<a class=\"link\" target=\"_blank\" href=\"${url}\">`,\n      '_a': '</a>'\n    })\n  }\n}\n\nfunction sanitize (inputString) {\n  return dompurify.sanitize(inputString, dompurifyConfig)\n}\n\nVue.component('i18n', {\n  functional: true,\n  props: {\n    args: [Object, Array],\n    tag: {\n      type: String,\n      default: 'span'\n    },\n    compile: Boolean\n  },\n  render: function (h, context) {\n    const text = context.children[0].text\n    const translation = L(text, context.props.args || {})\n    if (!translation) {\n      console.warn('The following i18n text was not translated correctly:', text)\n      return h(context.props.tag, context.data, text)\n    }\n    // Prevent reverse tabnabbing by including `rel=\"noopener noreferrer\"` when rendering as an outbound hyperlink.\n    if (context.props.tag === 'a' && context.data.attrs.target === '_blank') {\n      context.data.attrs.rel = 'noopener noreferrer'\n    }\n    if (context.props.compile) {\n      const result = Vue.compile('<wrap>' + sanitize(translation) + '</wrap>')\n      // console.log('TRANSLATED RENDERED TEXT:', context, result.render.toString())\n      return result.render.call({\n        _c: (tag, ...args) => {\n          if (tag === 'wrap') {\n            return h(context.props.tag, context.data, ...args)\n          } else {\n            return h(tag, ...args)\n          }\n        },\n        _v: x => x\n      })\n    } else {\n      if (!context.data.domProps) context.data.domProps = {}\n      context.data.domProps.innerHTML = sanitize(translation)\n      return h(context.props.tag, context.data)\n    }\n  }\n})\n", "const nargs = /\\{([0-9a-zA-Z_]+)\\}/g\n\nexport default function template (string        , ...args       )         {\n  const firstArg = args[0]\n  // If the first rest argument is a plain object or array, use it as replacement table.\n  // Otherwise, use the whole rest array as replacement table.\n  const replacementsByKey = (\n    (typeof firstArg === 'object' && firstArg !== null)\n      ? firstArg\n      : args\n  )\n\n  return string.replace(nargs, function replaceArg (match, capture, index) {\n    // Avoid replacing the capture if it is escaped by double curly braces.\n    if (string[index - 1] === '{' && string[index + match.length] === '}') {\n      return capture\n    }\n\n    const maybeReplacement = (\n      // Avoid accessing inherited properties of the replacement table.\n      // $FlowFixMe\n      Object.prototype.hasOwnProperty.call(replacementsByKey, capture)\n        ? replacementsByKey[capture]\n        : undefined\n    )\n\n    if (maybeReplacement === null || maybeReplacement === undefined) {\n      return ''\n    }\n    return String(maybeReplacement)\n  })\n}\n", "// to make rollup happy, I copied flowTyper-js\n// library into this file (it was refusing to\n// import because of the way functions were being\n// exported).\n//\n// GI EDIT NOTES:\n//\n// - The following functions can be used directly with 'validate'\n//   because they've had their '_scope' second parameter removed:\n//   - arrayOf\n//   - mapOf\n//   - object\n//   - objectOf\n//   - objectMaybeOf (this is a custom function that didn't exist in flowTyper)\n//\n// TODO: remove this file from eslintIgnore in package.json and fix errors\n\n                                             \n                                           \n                                                \n                                                      \n                                                       \n                                                            \n                                                 \n\n                                \n                   \n                  \n \n\n                                   \n                   \n                   \n                  \n \n\n                                      \n                   \n                   \n                   \n                   \n \n\n                                         \n                   \n                   \n                   \n                   \n                  \n \n\nexport const EMPTY_VALUE = Symbol('@@empty')\nexport const isEmpty = v => v === EMPTY_VALUE\nexport const isNil = v => v === null\nexport const isUndef = v => typeof v === 'undefined'\nexport const isBoolean = v => typeof v === 'boolean'\nexport const isNumber = v => typeof v === 'number'\nexport const isString = v => typeof v === 'string'\nexport const isObject = v => !isNil(v) && typeof v === 'object'\nexport const isFunction = v => typeof v === 'function'\n\nexport const isType = typeFn => (v, _scope = '') => {\n  try {\n    typeFn(v, _scope)\n    return true\n  } catch (_) {\n    return false\n  }\n}\n\n// This function will return value based on schema with inferred types. This\n// value can be used to define type in Flow with 'typeof' utility.\nexport const typeOf = schema => schema(EMPTY_VALUE, '')\nexport const getType = (typeFn, _options) => {\n  if (isFunction(typeFn.type)) return typeFn.type(_options)\n  return typeFn.name || '?'\n}\n\n// error\nexport class TypeValidatorError extends Error {\n  expectedType        \n  valueType        \n  value        \n  typeScope        \n  sourceFile        \n\n  constructor (\n    message         ,\n    expectedType        ,\n    valueType        ,\n    value        ,\n    typeName         = '',\n    typeScope          = ''\n  ) {\n    const errMessage = message ||\n      `invalid \"${valueType}\" value type; ${typeName || expectedType} type expected`\n    super(errMessage)\n    this.expectedType = expectedType\n    this.valueType = valueType\n    this.value = value\n    this.typeScope = typeScope || ''\n    this.sourceFile = this.getSourceFile()\n    this.message = `${errMessage}\\n${this.getErrorInfo()}`\n    this.name = this.constructor.name\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, TypeValidatorError)\n    }\n  }\n\n  getSourceFile ()         {\n    const fileNames = this.stack.match(/(\\/[\\w_\\-.]+)+(\\.\\w+:\\d+:\\d+)/g) || []\n    return fileNames.find(fileName => fileName.indexOf('/flowTyper-js/dist/') === -1) || ''\n  }\n\n  getErrorInfo ()         {\n    return `\n    file     ${this.sourceFile}\n    scope    ${this.typeScope}\n    expected ${this.expectedType.replace(/\\n/g, '')}\n    type     ${this.valueType}\n    value    ${this.value}\n`\n  }\n}\n\n// TypeValidatorError.prototype.name = 'TypeValidatorError'\n// exports.TypeValidatorError = TypeValidatorError\n\nconst validatorError =    (\n  typeFn                  ,\n  value       ,\n  scope         ,\n  message         ,\n  expectedType         ,\n  valueType         \n)                     => {\n  return new TypeValidatorError(\n    message,\n    expectedType || getType(typeFn),\n    valueType || typeof value,\n    JSON.stringify(value),\n    typeFn.name,\n    scope\n  )\n}\n\nexport const arrayOf =\n     (typeFn                  , _scope          = 'Array')                        => {\n    function array (value) {\n      if (isEmpty(value)) return [typeFn(value)]\n      if (Array.isArray(value)) {\n        let index = 0\n        return value.map(v => typeFn(v, `${_scope}[${index++}]`))\n      }\n      throw validatorError(array, value, _scope)\n    }\n    array.type = () => `Array<${getType(typeFn)}>`\n    return array\n  }\n\nexport const literalOf =\n                   (primitive   )                   => {\n    function literal (value, _scope = '') {\n      if (isEmpty(value) || (value === primitive)) return primitive\n      throw validatorError(literal, value, _scope)\n    }\n    literal.type = () => {\n      if (isBoolean(primitive)) return `${primitive ? 'true' : 'false'}`\n      else return `\"${primitive}\"`\n    }\n    return literal\n  }\n\nexport const mapOf =       (\n  keyTypeFn                  ,\n  typeFn                  \n)                            => {\n  function mapOf (value) {\n    if (isEmpty(value)) return {}\n    const o = object(value)\n    const reducer = (acc, key) =>\n      Object.assign(\n        acc,\n        {\n          // $FlowFixMe\n          [keyTypeFn(key, 'Map[_]')]: typeFn(o[key], `Map.${key}`)\n        }\n      )\n    return Object.keys(o).reduce(reducer, {})\n  }\n  mapOf.type = () => `{ [_:${getType(keyTypeFn)}]: ${getType(typeFn)} }`\n  return mapOf\n}\n\nconst isPrimitiveFn = (typeName) =>\n  ['undefined', 'null', 'boolean', 'number', 'string'].includes(typeName)\n\nexport const maybe =\n     (typeFn                  )                        => {\n    function maybe (value, _scope = '') {\n      return (isNil(value) || isUndef(value)) ? value : typeFn(value, _scope)\n    }\n    maybe.type = () => !isPrimitiveFn(typeFn.name) ? `?(${getType(typeFn)})` : `?${getType(typeFn)}`\n    return maybe\n  }\n\nexport const mixed = (\n  function mixed (value) {\n    return value\n  }                  \n)\n\nexport const object = (\n  function (value) {\n    if (isEmpty(value)) return {}\n    if (isObject(value) && !Array.isArray(value)) {\n      return Object.assign({}, value)\n    }\n    throw validatorError(object, value)\n  }                                    \n)\n\nexport const objectOf =                            \n  (typeObj   , _scope          = 'Object')                                                        => {\n  function object2 (value) {\n    const o = object(value)\n    const typeAttrs = Object.keys(typeObj)\n    const unknownAttr = Object.keys(o).find(attr => !typeAttrs.includes(attr))\n    if (unknownAttr) {\n      throw validatorError(\n        object2,\n        value,\n        _scope,\n        `missing object property '${unknownAttr}' in ${_scope} type`\n      )\n    }\n    // IMPORTANT: because esbuild can actually rename the functions in the compiled source\n    //            (e.g. from 'optional' to 'optional2'), we use .includes() instead of ===\n    //            to check the .name of a function\n    const undefAttr = typeAttrs.find(property => {\n      const propertyTypeFn = typeObj[property]\n      return (propertyTypeFn.name.includes('maybe') && !o.hasOwnProperty(property))\n    })\n    if (undefAttr) {\n      throw validatorError(\n        object2,\n        o[undefAttr],\n        `${_scope}.${undefAttr}`,\n        `empty object property '${undefAttr}' for ${_scope} type`,\n        `void | null | ${getType(typeObj[undefAttr]).substr(1)}`,\n        '-'\n      )\n    }\n\n    const reducer = isEmpty(value)\n      ? (acc, key) => Object.assign(acc, { [key]: typeObj[key](value) })\n      : (acc, key) => {\n        const typeFn = typeObj[key]\n        if (typeFn.name.includes('optional') && !o.hasOwnProperty(key)) {\n          return Object.assign(acc, {})\n        } else {\n          return Object.assign(acc, { [key]: typeFn(o[key], `${_scope}.${key}`) })\n        }\n      }\n    return typeAttrs.reduce(reducer, {})\n  }\n  object2.type = () => {\n    const props = Object.keys(typeObj).map(\n      (key) => {\n        const ret = typeObj[key].name.includes('optional')\n        ? `${key}?: ${getType(typeObj[key], { noVoid: true })}`\n        : `${key}: ${getType(typeObj[key])}`\n        return ret\n      }\n    )\n    return `{|\\n ${props.join(',\\n  ')} \\n|}`\n  }\n  return object2\n}\n\n// TODO: add flow type annotations and make it use validatorError etc.\nexport function objectMaybeOf (validations        , _scope          = 'Object')         {\n  return function (data     ) {\n    object(data)\n    for (const key in data) {\n      validations[key]?.(data[key], `${_scope}.${key}`)\n    }\n    return data\n  }\n}\n\nexport const optional =\n     (typeFn                  )                          => {\n    const unionFn = unionOf(typeFn, undef)\n    function optional (v) {\n      return unionFn(v)\n    }\n    optional.type = ({ noVoid }) => !noVoid ? getType(unionFn) : getType(typeFn)\n    return optional\n  }\n\nexport const nil = (\n  function nil (value) {\n    if (isEmpty(value) || isNil(value)) return null\n    throw validatorError(nil, value)\n  }\n                       \n)\n\nexport function undef (value, _scope = '') {\n  if (isEmpty(value) || isUndef(value)) return undefined\n  throw validatorError(undef, value, _scope)\n}\nundef.type = () => 'void'\n// export const undef = (undef: TypeValidator<void>)\n\nexport const boolean = (\n  function boolean (value, _scope = '') {\n    if (isEmpty(value)) return false\n    if (isBoolean(value)) return value\n    throw validatorError(boolean, value, _scope)\n  }\n                          \n)\n\nexport const number = (\n  function number (value, _scope = '') {\n    if (isEmpty(value)) return 0\n    if (isNumber(value)) return value\n    throw validatorError(number, value, _scope)\n  }\n                         \n)\n\nexport const string = (\n  function string (value, _scope = '') {\n    if (isEmpty(value)) return ''\n    if (isString(value)) return value\n    throw validatorError(string, value, _scope)\n  }\n                         \n)\n\n                            \n             \n                                     \n                                                 \n                                                             \n                                                                         \n                                                                                     \n                                                                                                 \n                                                                                                             \n                                                                                                                         \n                                                                                                                                     \n                                                                                                                                                 \n\nfunction tupleOf_ (...typeFuncs) {\n  function tuple (value       , _scope = '') {\n    const cardinality = typeFuncs.length\n    if (isEmpty(value)) return typeFuncs.map(fn => fn(value))\n    if (Array.isArray(value) && value.length === cardinality) {\n      const tupleValue = []\n      for (let i = 0; i < cardinality; i += 1) {\n        tupleValue.push(typeFuncs[i](value[i], _scope))\n      }\n      return tupleValue\n    }\n    throw validatorError(tuple, value, _scope)\n  }\n  tuple.type = () => `[${typeFuncs.map(fn => getType(fn)).join(', ')}]`\n  return tuple\n}\n\n// $FlowFixMe - $Tuple<(A, B, C, ...)[]>\n// const tupleOf: TupleT = tupleOf_\nexport const tupleOf = tupleOf_\n\n             \n                                   \n                                                \n                                                             \n                                                                          \n                                                                                       \n                                                                                                    \n                                                                                                                 \n                                                                                                                              \n                                                                                                                                           \n                                                                                                                                                        \n\nfunction unionOf_ (...typeFuncs) {\n  function union (value       , _scope = '') {\n    for (const typeFn of typeFuncs) {\n      try {\n        return typeFn(value, _scope)\n      } catch (_) {}\n    }\n    throw validatorError(union, value, _scope)\n  }\n  union.type = () => `(${typeFuncs.map(fn => getType(fn)).join(' | ')})`\n  return union\n}\n// $FlowFixMe\n// const unionOf: UnionT = (unionOf_)\nexport const unionOf = unionOf_", "'use strict'\n\nimport { L } from '@common/common.js'\n\nexport const MINS_MILLIS = 60000\nexport const HOURS_MILLIS = 60 * MINS_MILLIS\nexport const DAYS_MILLIS = 24 * HOURS_MILLIS\nexport const MONTHS_MILLIS = 30 * DAYS_MILLIS\n\nexport function addMonthsToDate (date        , months        )       {\n  const now = new Date(date)\n  return new Date(now.setMonth(now.getMonth() + months))\n}\n\n// It might be tempting to deal directly with Dates and ISOStrings, since that's basically\n// what a period stamp is at the moment, but keeping this abstraction allows us to change\n// our mind in the future simply by editing these two functions.\n// TODO: We may want to, for example, get the time from the server instead of relying on\n// the client in case the client's clock isn't set correctly.\n// See: https://github.com/okTurtles/group-income/issues/531\nexport function dateToPeriodStamp (date               )         {\n  return new Date(date).toISOString()\n}\n\nexport function dateFromPeriodStamp (daystamp        )       {\n  return new Date(daystamp)\n}\n\nexport function periodStampGivenDate ({ recentDate, periodStart, periodLength }   \n                                                               \n )         {\n  const periodStartDate = dateFromPeriodStamp(periodStart)\n  let nextPeriod = addTimeToDate(periodStartDate, periodLength)\n  const curDate = new Date(recentDate)\n  let curPeriod\n  if (curDate < nextPeriod) {\n    if (curDate >= periodStartDate) {\n      return periodStart // we're still in the same period\n    } else {\n      // we're in a period before the current one\n      curPeriod = periodStartDate\n      do {\n        curPeriod = addTimeToDate(curPeriod, -periodLength)\n      } while (curDate < curPeriod)\n    }\n  } else {\n    // we're at least a period ahead of periodStart\n    do {\n      curPeriod = nextPeriod\n      nextPeriod = addTimeToDate(nextPeriod, periodLength)\n    } while (curDate >= nextPeriod)\n  }\n  return dateToPeriodStamp(curPeriod)\n}\n\nexport function dateIsWithinPeriod ({ date, periodStart, periodLength }   \n                                                         \n )          {\n  const dateObj = new Date(date)\n  const start = dateFromPeriodStamp(periodStart)\n  return dateObj > start && dateObj < addTimeToDate(start, periodLength)\n}\n\nexport function addTimeToDate (date               , timeMillis        )       {\n  const d = new Date(date)\n  d.setTime(d.getTime() + timeMillis)\n  return d\n}\n\nexport function dateToMonthstamp (date               )         {\n  // we could use Intl.DateTimeFormat but that doesn't support .format() on Android\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DateTimeFormat/format\n  return new Date(date).toISOString().slice(0, 7)\n}\n\nexport function dateFromMonthstamp (monthstamp        )       {\n  // this is a hack to prevent new Date('2020-01').getFullYear() => 2019\n  return new Date(`${monthstamp}-01T00:01:00.000Z`) // the Z is important\n}\n\n// TODO: to prevent conflicts among user timezones, we need\n//       to use the server's time, and not our time here.\n//       https://github.com/okTurtles/group-income/issues/531\nexport function currentMonthstamp ()         {\n  return dateToMonthstamp(new Date())\n}\n\nexport function prevMonthstamp (monthstamp        )         {\n  const date = dateFromMonthstamp(monthstamp)\n  date.setMonth(date.getMonth() - 1)\n  return dateToMonthstamp(date)\n}\n\nexport function comparePeriodStamps (periodA        , periodB        )         {\n  return dateFromPeriodStamp(periodA).getTime() - dateFromPeriodStamp(periodB).getTime()\n}\n\nexport function compareMonthstamps (monthstampA        , monthstampB        )         {\n  return dateFromMonthstamp(monthstampA).getTime() - dateFromMonthstamp(monthstampB).getTime()\n  // const A = dateA.getMonth() + dateA.getFullYear() * 12\n  // const B = dateB.getMonth() + dateB.getFullYear() * 12\n  // return A - B\n}\n\nexport function compareISOTimestamps (a        , b        )         {\n  return new Date(a).getTime() - new Date(b).getTime()\n}\n\nexport function lastDayOfMonth (date      )       {\n  return new Date(date.getFullYear(), date.getMonth() + 1, 0)\n}\n\nexport function firstDayOfMonth (date      )       {\n  return new Date(date.getFullYear(), date.getMonth(), 1)\n}\n\nexport function humanDate (\n  date                        ,\n  options                              = { month: 'short', day: 'numeric' }\n)         {\n  const locale = typeof navigator === 'undefined'\n    // Fallback for Mocha tests.\n    ? 'en-US'\n    // Flow considers `navigator.languages` to be of type `$ReadOnlyArray<string>`,\n    // which is not compatible with the `string[]` expected by `.toLocaleDateString()`.\n    // Casting to `string[]` through `any` as a workaround.\n    : ((navigator.languages     )          ) ?? navigator.language\n  // NOTE: `.toLocaleDateString()` automatically takes local timezone differences into account.\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toLocaleDateString\n  return new Date(date).toLocaleDateString(locale, options)\n}\n\nexport function isPeriodStamp (arg        )          {\n  return /\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}.\\d{3}Z/.test(arg)\n}\n\nexport function isFullMonthstamp (arg        )          {\n  return /^\\d{4}-(0[1-9]|1[0-2])$/.test(arg)\n}\n\nexport function isMonthstamp (arg        )          {\n  return isShortMonthstamp(arg) || isFullMonthstamp(arg)\n}\n\nexport function isShortMonthstamp (arg        )          {\n  return /^(0[1-9]|1[0-2])$/.test(arg)\n}\n\nexport function monthName (monthstamp        )         {\n  return humanDate(dateFromMonthstamp(monthstamp), { month: 'long' })\n}\n\nexport function proximityDate (date      )         {\n  date = new Date(date)\n  const today = new Date()\n  const yesterday = (d => new Date(d.setDate(d.getDate() - 1)))(new Date())\n  const lastWeek = (d => new Date(d.setDate(d.getDate() - 7)))(new Date())\n\n  for (const toReset of [date, today, yesterday, lastWeek]) {\n    toReset.setHours(0)\n    toReset.setMinutes(0)\n    toReset.setSeconds(0, 0)\n  }\n\n  const datems = Number(date)\n  let pd = date > lastWeek ? humanDate(datems, { month: 'short', day: 'numeric', year: 'numeric' }) : humanDate(datems)\n  if (date.getTime() === yesterday.getTime()) pd = L('Yesterday')\n  if (date.getTime() === today.getTime()) pd = L('Today')\n\n  return pd\n}\n\nexport function timeSince (datems        , dateNow         = Date.now())         {\n  const interval = dateNow - datems\n\n  if (interval >= DAYS_MILLIS * 2) {\n    // Make sure to replace any ordinary space character by a non-breaking one.\n    return humanDate(datems).replace(/\\x32/g, '\\xa0')\n  }\n  if (interval >= DAYS_MILLIS) {\n    return L('1d')\n  }\n  if (interval >= HOURS_MILLIS) {\n    return L('{hours}h', { hours: Math.floor(interval / HOURS_MILLIS) })\n  }\n  if (interval >= MINS_MILLIS) {\n    // Maybe use 'min' symbol rather than 'm'?\n    return L('{minutes}m', { minutes: Math.max(1, Math.floor(interval / MINS_MILLIS)) })\n  }\n  return L('<1m')\n}\n\nexport function cycleAtDate (atDate               )         {\n  const now = new Date(atDate) // Just in case the parameter is a string type.\n  const partialCycles = now.getDate() / lastDayOfMonth(now).getDate()\n  return partialCycles\n}\n", "'use strict'\n\n// identity.js related\n\nexport const IDENTITY_PASSWORD_MIN_CHARS = 7\nexport const IDENTITY_USERNAME_MAX_CHARS = 80\n\n// group.js related\n\nexport const INVITE_INITIAL_CREATOR = 'invite-initial-creator'\nexport const INVITE_STATUS = {\n  REVOKED: 'revoked',\n  VALID: 'valid',\n  USED: 'used'\n}\nexport const PROFILE_STATUS = {\n  ACTIVE: 'active', // confirmed group join\n  PENDING: 'pending', // shortly after being approved to join the group\n  REMOVED: 'removed'\n}\n\nexport const PROPOSAL_RESULT = 'proposal-result'\nexport const PROPOSAL_INVITE_MEMBER = 'invite-member'\nexport const PROPOSAL_REMOVE_MEMBER = 'remove-member'\nexport const PROPOSAL_GROUP_SETTING_CHANGE = 'group-setting-change'\nexport const PROPOSAL_PROPOSAL_SETTING_CHANGE = 'proposal-setting-change'\nexport const PROPOSAL_GENERIC = 'generic'\n\nexport const PROPOSAL_ARCHIVED = 'proposal-archived'\nexport const MAX_ARCHIVED_PROPOSALS = 100\n\nexport const STATUS_OPEN = 'open'\nexport const STATUS_PASSED = 'passed'\nexport const STATUS_FAILED = 'failed'\nexport const STATUS_EXPIRED = 'expired'\nexport const STATUS_CANCELLED = 'cancelled'\n\n// chatroom.js related\n\nexport const CHATROOM_GENERAL_NAME = 'General'\nexport const CHATROOM_NAME_LIMITS_IN_CHARS = 50\nexport const CHATROOM_DESCRIPTION_LIMITS_IN_CHARS = 280\nexport const CHATROOM_ACTIONS_PER_PAGE = 40\nexport const CHATROOM_MESSAGES_PER_PAGE = 20\n\n// chatroom events\nexport const CHATROOM_MESSAGE_ACTION = 'chatroom-message-action'\nexport const CHATROOM_DETAILS_UPDATED = 'chatroom-details-updated'\nexport const MESSAGE_RECEIVE = 'message-receive'\nexport const MESSAGE_SEND = 'message-send'\n\nexport const CHATROOM_TYPES = {\n  INDIVIDUAL: 'individual',\n  GROUP: 'group'\n}\n\nexport const CHATROOM_PRIVACY_LEVEL = {\n  GROUP: 'chatroom-privacy-level-group',\n  PRIVATE: 'chatroom-privacy-level-private',\n  PUBLIC: 'chatroom-privacy-level-public'\n}\n\nexport const MESSAGE_TYPES = {\n  POLL: 'message-poll',\n  TEXT: 'message-text',\n  INTERACTIVE: 'message-interactive',\n  NOTIFICATION: 'message-notification'\n}\n\nexport const INVITE_EXPIRES_IN_DAYS = {\n  ON_BOARDING: 30,\n  PROPOSAL: 7\n}\n\nexport const MESSAGE_NOTIFICATIONS = {\n  ADD_MEMBER: 'add-member',\n  JOIN_MEMBER: 'join-member',\n  LEAVE_MEMBER: 'leave-member',\n  KICK_MEMBER: 'kick-member',\n  UPDATE_DESCRIPTION: 'update-description',\n  UPDATE_NAME: 'update-name',\n  DELETE_CHANNEL: 'delete-channel',\n  VOTE: 'vote'\n}\n\nexport const MESSAGE_VARIANTS = {\n  PENDING: 'pending',\n  SENT: 'sent',\n  RECEIVED: 'received',\n  FAILED: 'failed'\n}\n\n// mailbox.js related\n\nexport const MAIL_TYPE_MESSAGE = 'message'\nexport const MAIL_TYPE_FRIEND_REQ = 'friend-request'\n", "'use strict'\n\nimport { literalOf, unionOf } from '~/frontend/model/contracts/misc/flowTyper.js'\nimport {\n  PROPOSAL_REMOVE_MEMBER,\n  PROFILE_STATUS\n} from '../constants.js'\n\nexport const VOTE_AGAINST = ':against'\nexport const VOTE_INDIFFERENT = ':indifferent'\nexport const VOTE_UNDECIDED = ':undecided'\nexport const VOTE_FOR = ':for'\n\nexport const RULE_PERCENTAGE = 'percentage'\nexport const RULE_DISAGREEMENT = 'disagreement'\nexport const RULE_MULTI_CHOICE = 'multi-choice'\n\n// TODO: ranked-choice? :D\n\n/* REVIVEW PR\n  the whole \"state\" being passed as argument to rules[rule]() is overwhelmed.\n  It would be simpler with just 2 simple args: \"threshold\" and \"population\".\n  Advantages:\n  - population: No need to do the logic to get it (and avoid import PROFILE_STATUS.ACTIVE from group.js).\n  - threshold: The selector to get the selector is huge.\n  - tests: Avoid the need to mock a complex state.\n  My suggestion: 1 parameter (object) with 4 explicit keys.\n  [RULE_PERCENTAGE]: function ({ votes, proposalType, population, threshold })\n*/\n\nconst getPopulation = (state) => Object.keys(state.profiles).filter(p => state.profiles[p].status === PROFILE_STATUS.ACTIVE).length\n\nconst rules         = {\n  [RULE_PERCENTAGE]: function (state, proposalType, votes) {\n    votes = Object.values(votes)\n    let population = getPopulation(state)\n    if (proposalType === PROPOSAL_REMOVE_MEMBER) population -= 1\n    const defaultThreshold = state.settings.proposals[proposalType].ruleSettings[RULE_PERCENTAGE].threshold\n    const threshold = getThresholdAdjusted(RULE_PERCENTAGE, defaultThreshold, population)\n    const totalIndifferent = votes.filter(x => x === VOTE_INDIFFERENT).length\n    const totalFor = votes.filter(x => x === VOTE_FOR).length\n    const totalAgainst = votes.filter(x => x === VOTE_AGAINST).length\n    const totalForOrAgainst = totalFor + totalAgainst\n    const turnout = totalForOrAgainst + totalIndifferent\n    const absent = population - turnout\n    // TODO: figure out if this is the right way to figure out the \"neededToPass\" number\n    //       and if so, explain it in the UI that the threshold is applied only to\n    //       *those who care, plus those who were abscent*.\n    //       Those who explicitely say they don't care are removed from consideration.\n    const neededToPass = Math.ceil(threshold * (population - totalIndifferent))\n    console.debug(`votingRule ${RULE_PERCENTAGE} for ${proposalType}:`, { neededToPass, totalFor, totalAgainst, totalIndifferent, threshold, absent, turnout, population })\n    if (totalFor >= neededToPass) {\n      return VOTE_FOR\n    }\n    return totalFor + absent < neededToPass ? VOTE_AGAINST : VOTE_UNDECIDED\n  },\n  [RULE_DISAGREEMENT]: function (state, proposalType, votes) {\n    votes = Object.values(votes)\n    const population = getPopulation(state)\n    const minimumMax = proposalType === PROPOSAL_REMOVE_MEMBER ? 2 : 1\n    const thresholdOriginal = Math.max(state.settings.proposals[proposalType].ruleSettings[RULE_DISAGREEMENT].threshold, minimumMax)\n    const threshold = getThresholdAdjusted(RULE_DISAGREEMENT, thresholdOriginal, population)\n    const totalFor = votes.filter(x => x === VOTE_FOR).length\n    const totalAgainst = votes.filter(x => x === VOTE_AGAINST).length\n    const turnout = votes.length\n    const absent = population - turnout\n\n    console.debug(`votingRule ${RULE_DISAGREEMENT} for ${proposalType}:`, { totalFor, totalAgainst, threshold, turnout, population, absent })\n    if (totalAgainst >= threshold) {\n      return VOTE_AGAINST\n    }\n    // consider proposal passed if more vote for it than against it and there aren't\n    // enough votes left to tip the scales past the threshold\n    return totalAgainst + absent < threshold ? VOTE_FOR : VOTE_UNDECIDED\n  },\n  [RULE_MULTI_CHOICE]: function (state, proposalType, votes) {\n    throw new Error('unimplemented!')\n    // TODO: return VOTE_UNDECIDED if 0 votes, otherwise value w/greatest number of votes\n    //       the proposal/poll is considered passed only after the expiry time period\n    // NOTE: are we sure though that this even belongs here as a voting rule...?\n    //       perhaps there could be a situation were one of several valid settings options\n    //       is being proposed... in effect this would be a plurality voting rule\n  }\n}\n\nexport default rules\n\nexport const ruleType      = unionOf(...Object.keys(rules).map(k => literalOf(k)))\n\n/**\n *\n * @example ('disagreement', 2, 1) => 2\n * @example ('disagreement', 5, 1) => 3\n * @example ('disagreement', 7, 10) => 7\n * @example ('disagreement', 20, 10) => 10\n *\n * @example ('percentage', 0.5, 3) => 0.5\n * @example ('percentage', 0.1, 3) => 0.33\n * @example ('percentage', 0.1, 10) => 0.2\n * @example ('percentage', 0.3, 10) => 0.3\n */\nexport const getThresholdAdjusted = (rule        , threshold        , groupSize        )         => {\n  const groupSizeVoting = Math.max(3, groupSize) // 3 = minimum groupSize to vote\n\n  return {\n    [RULE_DISAGREEMENT]: () => {\n      // Limit number of maximum \"no\" votes to group size\n      return Math.min(groupSizeVoting - 1, threshold)\n    },\n    [RULE_PERCENTAGE]: () => {\n      // Minimum threshold correspondent to 2 \"yes\" votes\n      const minThreshold = 2 / groupSizeVoting\n      return Math.max(minThreshold, threshold)\n    }\n  }[rule]()\n}\n\n/**\n *\n * @example (10, 0.5) => 5\n * @example (3, 0.8) => 3\n * @example (1, 0.6) => 2\n */\nexport const getCountOutOfMembers = (groupSize        , decimal        )         => {\n  const minGroupSize = 3 // when group can vote\n  return Math.ceil(Math.max(minGroupSize, groupSize) * decimal)\n}\n\nexport const getPercentFromDecimal = (decimal        )         => {\n  // convert decimal to percentage avoiding weird decimals results.\n  // e.g. 0.58 -> 58 instead of 57.99999\n  return Math.round(decimal * 100)\n}\n", "'use strict'\n\nimport sbp from '@sbp/sbp'\nimport { Vue } from '@common/common.js'\nimport { objectOf, literalOf, unionOf, number } from '~/frontend/model/contracts/misc/flowTyper.js'\nimport { DAYS_MILLIS } from '../time.js'\nimport rules, { ruleType, VOTE_UNDECIDED, VOTE_AGAINST, VOTE_FOR, RULE_PERCENTAGE, RULE_DISAGREEMENT } from './rules.js'\nimport {\n  PROPOSAL_RESULT,\n  PROPOSAL_INVITE_MEMBER,\n  PROPOSAL_REMOVE_MEMBER,\n  PROPOSAL_GROUP_SETTING_CHANGE,\n  PROPOSAL_PROPOSAL_SETTING_CHANGE,\n  PROPOSAL_GENERIC,\n  // STATUS_OPEN,\n  STATUS_PASSED,\n  STATUS_FAILED\n  // STATUS_EXPIRED,\n  // STATUS_CANCELLED\n} from '../constants.js'\n\nexport function archiveProposal ({ state, proposalHash, proposal, contractID }) {\n  Vue.delete(state.proposals, proposalHash)\n  sbp('gi.contracts/group/pushSideEffect', contractID,\n    ['gi.contracts/group/archiveProposal', contractID, proposalHash, proposal]\n  )\n}\n\nexport function buildInvitationUrl (groupId        , inviteSecret        )         {\n  return `${location.origin}/app/join?groupId=${groupId}&secret=${inviteSecret}`\n}\n\nexport const proposalSettingsType      = objectOf({\n  rule: ruleType,\n  expires_ms: number,\n  ruleSettings: objectOf({\n    [RULE_PERCENTAGE]: objectOf({ threshold: number }),\n    [RULE_DISAGREEMENT]: objectOf({ threshold: number })\n  })\n})\n\n// returns true IF a single YES vote is required to pass the proposal\nexport function oneVoteToPass (proposalHash        )          {\n  const rootState = sbp('state/vuex/state')\n  const state = rootState[rootState.currentGroupId]\n  const proposal = state.proposals[proposalHash]\n  const votes = Object.assign({}, proposal.votes)\n  const currentResult = rules[proposal.data.votingRule](state, proposal.data.proposalType, votes)\n  votes[String(Math.random())] = VOTE_FOR\n  const newResult = rules[proposal.data.votingRule](state, proposal.data.proposalType, votes)\n  console.debug(`oneVoteToPass currentResult(${currentResult}) newResult(${newResult})`)\n\n  return currentResult === VOTE_UNDECIDED && newResult === VOTE_FOR\n}\n\nfunction voteAgainst (state     , { meta, data, contractID }     ) {\n  const { proposalHash } = data\n  const proposal = state.proposals[proposalHash]\n  proposal.status = STATUS_FAILED\n  sbp('okTurtles.events/emit', PROPOSAL_RESULT, state, VOTE_AGAINST, data)\n  archiveProposal({ state, proposalHash, proposal, contractID })\n}\n\n// NOTE: The code is ready to receive different proposals settings,\n// However, we decided to make all settings the same, to simplify the UI/UX proptotype.\nexport const proposalDefaults = {\n  rule: RULE_PERCENTAGE,\n  expires_ms: 14 * DAYS_MILLIS,\n  ruleSettings: ({\n    [RULE_PERCENTAGE]: { threshold: 0.66 },\n    [RULE_DISAGREEMENT]: { threshold: 1 }\n  }                                                                            )\n}\n\nconst proposals         = {\n  [PROPOSAL_INVITE_MEMBER]: {\n    defaults: proposalDefaults,\n    [VOTE_FOR]: function (state, { meta, data, contractID }) {\n      const { proposalHash } = data\n      const proposal = state.proposals[proposalHash]\n      proposal.payload = data.passPayload\n      proposal.status = STATUS_PASSED\n      // NOTE: if invite/process requires more than just data+meta\n      //       this code will need to be updated...\n      const message = { meta, data: data.passPayload, contractID }\n      sbp('gi.contracts/group/invite/process', message, state)\n      sbp('okTurtles.events/emit', PROPOSAL_RESULT, state, VOTE_FOR, data)\n      archiveProposal({ state, proposalHash, proposal, contractID })\n      // TODO: for now, generate the link and send it to the user's inbox\n      //       however, we cannot send GIMessages in any way from here\n      //       because that means each time someone synchronizes this contract\n      //       a new invite would be sent...\n      //       which means the voter who casts the deciding ballot needs to\n      //       include in this message the authorization for the new user to\n      //       join the group.\n      //       we could make it so that all users generate the same authorization\n      //       somehow...\n      //       however if it's an OP_KEY_* message ther can only be one of those!\n      //\n      //       so, the deciding voter is the one that generates the passPayload data for the\n      //       link includes the OP_KEY_* message in their final vote authorizing\n      //       the user.\n      //       additionally, for our testing purposes, we check to see if the\n      //       currently logged in user is the deciding voter, and if so we\n      //       send a message to that user's inbox with the link. The user\n      //       clicks the link and then generates an invite accept or invite decline message.\n      //\n      //       we no longer have a state.invitees, instead we have a state.invites\n      // sbp('okTurtles.events/emit', PROPOSAL_RESULT, state, VOTE_FOR, data)\n      // TODO: generate and save invite link, which is used to generate a group/inviteAccept message\n      //       the invite link contains the secret to a public/private keypair that is generated\n      //       by the final voter, this keypair is a special \"write only\" keypair that is allowed\n      //       to only send a single kind of message to the group (accepting the invite, deleting\n      //       the writeonly keypair, and registering a new keypair with the group that has\n      //       full member privileges, i.e. their identity contract). The writeonly keypair\n      //       that's registered originally also contains attributes that tell the server\n      //       what kind of message(s) it's allowed to send to the contract, and how many\n      //       of them.\n    },\n    [VOTE_AGAINST]: voteAgainst\n  },\n  [PROPOSAL_REMOVE_MEMBER]: {\n    defaults: proposalDefaults,\n    [VOTE_FOR]: function (state, { meta, data, contractID }) {\n      const { proposalHash, passPayload } = data\n      const proposal = state.proposals[proposalHash]\n      proposal.status = STATUS_PASSED\n      proposal.payload = passPayload\n      const messageData = {\n        ...proposal.data.proposalData,\n        proposalHash,\n        proposalPayload: passPayload\n      }\n      const message = { data: messageData, meta, contractID }\n      sbp('gi.contracts/group/removeMember/process', message, state)\n      sbp('gi.contracts/group/pushSideEffect', contractID,\n        ['gi.contracts/group/removeMember/sideEffect', message]\n      )\n      archiveProposal({ state, proposalHash, proposal, contractID })\n    },\n    [VOTE_AGAINST]: voteAgainst\n  },\n  [PROPOSAL_GROUP_SETTING_CHANGE]: {\n    defaults: proposalDefaults,\n    [VOTE_FOR]: function (state, { meta, data, contractID }) {\n      const { proposalHash } = data\n      const proposal = state.proposals[proposalHash]\n      proposal.status = STATUS_PASSED\n      const { setting, proposedValue } = proposal.data.proposalData\n      // NOTE: if updateSettings ever needs more ethana just meta+data\n      //       this code will need to be updated\n      const message = {\n        meta,\n        data: { [setting]: proposedValue },\n        contractID\n      }\n      sbp('gi.contracts/group/updateSettings/process', message, state)\n      archiveProposal({ state, proposalHash, proposal, contractID })\n    },\n    [VOTE_AGAINST]: voteAgainst\n  },\n  [PROPOSAL_PROPOSAL_SETTING_CHANGE]: {\n    defaults: proposalDefaults,\n    [VOTE_FOR]: function (state, { meta, data, contractID }) {\n      const { proposalHash } = data\n      const proposal = state.proposals[proposalHash]\n      proposal.status = STATUS_PASSED\n      const message = {\n        meta,\n        data: proposal.data.proposalData,\n        contractID\n      }\n      sbp('gi.contracts/group/updateAllVotingRules/process', message, state)\n      archiveProposal({ state, proposalHash, proposal, contractID })\n    },\n    [VOTE_AGAINST]: voteAgainst\n  },\n  [PROPOSAL_GENERIC]: {\n    defaults: proposalDefaults,\n    [VOTE_FOR]: function (state, { meta, data, contractID }) {\n      const { proposalHash } = data\n      const proposal = state.proposals[proposalHash]\n      proposal.status = STATUS_PASSED\n      sbp('okTurtles.events/emit', PROPOSAL_RESULT, state, VOTE_FOR, data)\n      archiveProposal({ state, proposalHash, proposal, contractID })\n    },\n    [VOTE_AGAINST]: voteAgainst\n  }\n}\n\nexport default proposals\n\nexport const proposalType      = unionOf(...Object.keys(proposals).map(k => literalOf(k)))\n"],
  "mappings": ";;;AAKA,IAAM,YAAY,CAAC;AACnB,IAAM,UAAU,CAAC;AACjB,IAAM,gBAAgB,CAAC;AACvB,IAAM,gBAAgB,CAAC;AACvB,IAAM,kBAAkB,CAAC;AACzB,IAAM,kBAAkB,CAAC;AAEzB,IAAM,eAAe;AAErB,aAAc,aAAa,MAAM;AAC/B,QAAM,SAAS,mBAAmB,QAAQ;AAC1C,MAAI,CAAC,UAAU,WAAW;AACxB,UAAM,IAAI,MAAM,iCAAiC,UAAU;AAAA,EAC7D;AAGA,aAAW,WAAW,CAAC,gBAAgB,WAAW,cAAc,SAAS,aAAa,GAAG;AACvF,QAAI,SAAS;AACX,iBAAW,UAAU,SAAS;AAC5B,YAAI,OAAO,QAAQ,UAAU,IAAI,MAAM;AAAO;AAAA,MAChD;AAAA,IACF;AAAA,EACF;AACA,SAAO,UAAU,UAAU,KAAK,QAAQ,QAAQ,OAAO,GAAG,IAAI;AAChE;AAEO,4BAA6B,UAAU;AAC5C,QAAM,eAAe,aAAa,KAAK,QAAQ;AAC/C,MAAI,iBAAiB,MAAM;AACzB,UAAM,IAAI,MAAM,iCAAiC,UAAU;AAAA,EAC7D;AACA,SAAO,aAAa;AACtB;AAEA,IAAM,qBAAqB;AAAA,EACzB,0BAA0B,SAAU,MAAM;AACxC,UAAM,aAAa,CAAC;AACpB,eAAW,YAAY,MAAM;AAC3B,YAAM,SAAS,mBAAmB,QAAQ;AAC1C,UAAI,UAAU,WAAW;AACvB,QAAC,SAAQ,QAAQ,QAAQ,KAAK,6DAA6D,WAAW;AAAA,MACxG,WAAW,OAAO,KAAK,cAAc,YAAY;AAC/C,YAAI,gBAAgB,WAAW;AAE7B,UAAC,SAAQ,QAAQ,QAAQ,KAAK,6CAA6C,gDAAgD;AAAA,QAC7H;AACA,cAAM,KAAK,UAAU,YAAY,KAAK;AACtC,mBAAW,KAAK,QAAQ;AAExB,YAAI,CAAC,QAAQ,SAAS;AACpB,kBAAQ,UAAU,EAAE,OAAO,CAAC,EAAE;AAAA,QAChC;AAEA,YAAI,aAAa,GAAG,gBAAgB;AAClC,aAAG,KAAK,QAAQ,QAAQ,KAAK;AAAA,QAC/B;AAAA,MACF;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAAA,EACA,4BAA4B,SAAU,MAAM;AAC1C,eAAW,YAAY,MAAM;AAC3B,UAAI,CAAC,gBAAgB,WAAW;AAC9B,cAAM,IAAI,MAAM,0CAA0C,UAAU;AAAA,MACtE;AACA,aAAO,UAAU;AAAA,IACnB;AAAA,EACF;AAAA,EACA,2BAA2B,SAAU,MAAM;AACzC,QAAI,4BAA4B,OAAO,KAAK,IAAI,CAAC;AACjD,WAAO,IAAI,0BAA0B,IAAI;AAAA,EAC3C;AAAA,EACA,wBAAwB,SAAU,MAAM;AACtC,eAAW,YAAY,MAAM;AAC3B,UAAI,UAAU,WAAW;AACvB,cAAM,IAAI,MAAM,mDAAmD;AAAA,MACrE;AACA,sBAAgB,YAAY;AAAA,IAC9B;AAAA,EACF;AAAA,EACA,sBAAsB,SAAU,MAAM;AACpC,eAAW,YAAY,MAAM;AAC3B,aAAO,gBAAgB;AAAA,IACzB;AAAA,EACF;AAAA,EACA,oBAAoB,SAAU,KAAK;AACjC,WAAO,UAAU;AAAA,EACnB;AAAA,EACA,0BAA0B,SAAU,QAAQ;AAC1C,kBAAc,KAAK,MAAM;AAAA,EAC3B;AAAA,EACA,0BAA0B,SAAU,QAAQ,QAAQ;AAClD,QAAI,CAAC,cAAc;AAAS,oBAAc,UAAU,CAAC;AACrD,kBAAc,QAAQ,KAAK,MAAM;AAAA,EACnC;AAAA,EACA,4BAA4B,SAAU,UAAU,QAAQ;AACtD,QAAI,CAAC,gBAAgB;AAAW,sBAAgB,YAAY,CAAC;AAC7D,oBAAgB,UAAU,KAAK,MAAM;AAAA,EACvC;AACF;AAEA,mBAAmB,0BAA0B,kBAAkB;AAE/D,IAAO,iBAAQ;;;ACpFf;;;ACNA;AACA;;;ACwBO,mBAAoB,KAAK;AAC9B,SAAO,KAAK,MAAM,KAAK,UAAU,GAAG,CAAC;AACvC;;;ADtBO,IAAM,gBAAgB;AAAA,EAC3B,cAAc,CAAC,OAAO;AAAA,EACtB,cAAc,CAAC,KAAK,MAAM,MAAM,KAAK,KAAK,SAAS,QAAQ,UAAU,OAAO,OAAO,GAAG;AAAA,EAEtF,qBAAqB;AACvB;AAEA,IAAM,YAAY,CAAC,IAAI,YAAY;AACjC,MAAI,QAAQ,aAAa,QAAQ,OAAO;AACtC,QAAI,SAAS;AACb,QAAI,QAAQ,QAAQ,KAAK;AACvB,eAAS,UAAU,MAAM;AACzB,aAAO,aAAa,KAAK,QAAQ,QAAQ;AACzC,aAAO,aAAa,KAAK,GAAG;AAAA,IAC9B;AACA,OAAG,cAAc;AACjB,OAAG,YAAY,UAAU,SAAS,QAAQ,OAAO,MAAM,CAAC;AAAA,EAC1D;AACF;AAWA,IAAI,UAAU,aAAa;AAAA,EACzB,MAAM;AAAA,EACN,QAAQ;AACV,CAAC;;;AElDD;AACA;;;ACNA,IAAM,QAAQ;AAEC,kBAAmB,WAAmB,MAAqB;AACxE,QAAM,WAAW,KAAK;AAGtB,QAAM,oBACH,OAAO,aAAa,YAAY,aAAa,OAC1C,WACA;AAGN,SAAO,OAAO,QAAQ,OAAO,oBAAqB,OAAO,SAAS,OAAO;AAEvE,QAAI,OAAO,QAAQ,OAAO,OAAO,OAAO,QAAQ,MAAM,YAAY,KAAK;AACrE,aAAO;AAAA,IACT;AAEA,UAAM,mBAGJ,OAAO,UAAU,eAAe,KAAK,mBAAmB,OAAO,IAC3D,kBAAkB,WAClB;AAGN,QAAI,qBAAqB,QAAQ,qBAAqB,QAAW;AAC/D,aAAO;AAAA,IACT;AACA,WAAO,OAAO,gBAAgB;AAAA,EAChC,CAAC;AACH;;;ADtBA,KAAI,UAAU,IAAI;AAClB,KAAI,UAAU,QAAQ;AAEtB,IAAM,kBAAkB;AACxB,IAAM,sBAAsB;AAC5B,IAAM,0BAAgD,CAAC;AAOvD,IAAM,kBAAkB;AAAA,EACtB,GAAG;AAAA,EACH,cAAc,CAAC,SAAS,QAAQ,OAAO,QAAQ;AAAA,EAC/C,cAAc,CAAC,KAAK,KAAK,MAAM,UAAU,MAAM,KAAK,KAAK,SAAS,QAAQ,UAAU,OAAO,OAAO,GAAG;AAAA,EACrG,qBAAqB;AACvB;AAEA,IAAI,kBAAkB;AACtB,IAAI,sBAAsB,gBAAgB,MAAM,GAAG,EAAE;AACrD,IAAI,0BAA0B;AAY9B,eAAI,0BAA0B;AAAA,EAC5B,qBAAqB,oBAAqB,UAAiC;AAEzE,UAAM,CAAC,gBAAgB,SAAS,YAAY,EAAE,MAAM,GAAG;AAGvD,QAAI,SAAS,YAAY,MAAM,gBAAgB,YAAY;AAAG;AAI9D,QAAI,iBAAiB;AAAqB;AAG1C,QAAI,iBAAiB,qBAAqB;AACxC,wBAAkB;AAClB,4BAAsB;AACtB,gCAA0B;AAC1B;AAAA,IACF;AACA,QAAI;AACF,gCAA2B,MAAM,eAAI,4BAA4B,QAAQ,KAAM;AAG/E,wBAAkB;AAClB,4BAAsB;AAAA,IACxB,SAAS,OAAP;AACA,cAAQ,MAAM,KAAK;AAAA,IACrB;AAAA,EACF;AACF,CAAC;AA0CM,kBAAmB,MAAiC;AACzD,QAAM,IAAI;AAAA,IACR,OAAO;AAAA,EACT;AACA,aAAW,OAAO,MAAM;AACtB,MAAE,GAAG,UAAU,IAAI;AACnB,MAAE,IAAI,SAAS,KAAK;AAAA,EACtB;AACA,SAAO;AACT;AAEe,WACb,KACA,MACQ;AACR,SAAO,SAAS,wBAAwB,QAAQ,KAAK,IAAI,EAEtD,QAAQ,iBAAiB,QAAQ;AACtC;AAgBA,kBAAmB,aAAa;AAC9B,SAAO,WAAU,SAAS,aAAa,eAAe;AACxD;AAEA,KAAI,UAAU,QAAQ;AAAA,EACpB,YAAY;AAAA,EACZ,OAAO;AAAA,IACL,MAAM,CAAC,QAAQ,KAAK;AAAA,IACpB,KAAK;AAAA,MACH,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,IACA,SAAS;AAAA,EACX;AAAA,EACA,QAAQ,SAAU,GAAG,SAAS;AAC5B,UAAM,OAAO,QAAQ,SAAS,GAAG;AACjC,UAAM,cAAc,EAAE,MAAM,QAAQ,MAAM,QAAQ,CAAC,CAAC;AACpD,QAAI,CAAC,aAAa;AAChB,cAAQ,KAAK,yDAAyD,IAAI;AAC1E,aAAO,EAAE,QAAQ,MAAM,KAAK,QAAQ,MAAM,IAAI;AAAA,IAChD;AAEA,QAAI,QAAQ,MAAM,QAAQ,OAAO,QAAQ,KAAK,MAAM,WAAW,UAAU;AACvE,cAAQ,KAAK,MAAM,MAAM;AAAA,IAC3B;AACA,QAAI,QAAQ,MAAM,SAAS;AACzB,YAAM,SAAS,KAAI,QAAQ,WAAW,SAAS,WAAW,IAAI,SAAS;AAEvE,aAAO,OAAO,OAAO,KAAK;AAAA,QACxB,IAAI,CAAC,QAAQ,SAAS;AACpB,cAAI,QAAQ,QAAQ;AAClB,mBAAO,EAAE,QAAQ,MAAM,KAAK,QAAQ,MAAM,GAAG,IAAI;AAAA,UACnD,OAAO;AACL,mBAAO,EAAE,KAAK,GAAG,IAAI;AAAA,UACvB;AAAA,QACF;AAAA,QACA,IAAI,OAAK;AAAA,MACX,CAAC;AAAA,IACH,OAAO;AACL,UAAI,CAAC,QAAQ,KAAK;AAAU,gBAAQ,KAAK,WAAW,CAAC;AACrD,cAAQ,KAAK,SAAS,YAAY,SAAS,WAAW;AACtD,aAAO,EAAE,QAAQ,MAAM,KAAK,QAAQ,IAAI;AAAA,IAC1C;AAAA,EACF;AACF,CAAC;;;AE5IM,IAAM,cAAc,OAAO,SAAS;AACpC,IAAM,UAAU,OAAK,MAAM;AAC3B,IAAM,QAAQ,OAAK,MAAM;AACzB,IAAM,UAAU,OAAK,OAAO,MAAM;AAClC,IAAM,YAAY,OAAK,OAAO,MAAM;AACpC,IAAM,WAAW,OAAK,OAAO,MAAM;AAEnC,IAAM,WAAW,OAAK,CAAC,MAAM,CAAC,KAAK,OAAO,MAAM;AAChD,IAAM,aAAa,OAAK,OAAO,MAAM;AAcrC,IAAM,UAAU,CAAC,QAAQ,aAAa;AAC3C,MAAI,WAAW,OAAO,IAAI;AAAG,WAAO,OAAO,KAAK,QAAQ;AACxD,SAAO,OAAO,QAAQ;AACxB;AAGO,IAAM,qBAAN,cAAiC,MAAM;AAAA,EAC5C;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EAEA,YACE,SACA,cACA,WACA,OACA,WAAmB,IACnB,YAAqB,IACrB;AACA,UAAM,aAAa,WACjB,YAAY,0BAA0B,YAAY;AACpD,UAAM,UAAU;AAChB,SAAK,eAAe;AACpB,SAAK,YAAY;AACjB,SAAK,QAAQ;AACb,SAAK,YAAY,aAAa;AAC9B,SAAK,aAAa,KAAK,cAAc;AACrC,SAAK,UAAU,GAAG;AAAA,EAAe,KAAK,aAAa;AACnD,SAAK,OAAO,KAAK,YAAY;AAC7B,QAAI,MAAM,mBAAmB;AAC3B,YAAM,kBAAkB,MAAM,kBAAkB;AAAA,IAClD;AAAA,EACF;AAAA,EAEA,gBAAyB;AACvB,UAAM,YAAY,KAAK,MAAM,MAAM,gCAAgC,KAAK,CAAC;AACzE,WAAO,UAAU,KAAK,cAAY,SAAS,QAAQ,qBAAqB,MAAM,EAAE,KAAK;AAAA,EACvF;AAAA,EAEA,eAAwB;AACtB,WAAO;AAAA,eACI,KAAK;AAAA,eACL,KAAK;AAAA,eACL,KAAK,aAAa,QAAQ,OAAO,EAAE;AAAA,eACnC,KAAK;AAAA,eACL,KAAK;AAAA;AAAA,EAElB;AACF;AAKA,IAAM,iBAAoB,CACxB,QACA,OACA,OACA,SACA,cACA,cACuB;AACvB,SAAO,IAAI,mBACT,SACA,gBAAgB,QAAQ,MAAM,GAC9B,aAAa,OAAO,OACpB,KAAK,UAAU,KAAK,GACpB,OAAO,MACP,KACF;AACF;AAgBO,IAAM,YACM,CAAC,cAAmC;AACnD,mBAAkB,OAAO,SAAS,IAAI;AACpC,QAAI,QAAQ,KAAK,KAAM,UAAU;AAAY,aAAO;AACpD,UAAM,eAAe,SAAS,OAAO,MAAM;AAAA,EAC7C;AACA,UAAQ,OAAO,MAAM;AACnB,QAAI,UAAU,SAAS;AAAG,aAAO,GAAG,YAAY,SAAS;AAAA;AACpD,aAAO,IAAI;AAAA,EAClB;AACA,SAAO;AACT;AAyCK,IAAM,SACX,SAAU,OAAO;AACf,MAAI,QAAQ,KAAK;AAAG,WAAO,CAAC;AAC5B,MAAI,SAAS,KAAK,KAAK,CAAC,MAAM,QAAQ,KAAK,GAAG;AAC5C,WAAO,OAAO,OAAO,CAAC,GAAG,KAAK;AAAA,EAChC;AACA,QAAM,eAAe,QAAQ,KAAK;AACpC;AAGK,IAAM,WACX,CAAC,SAAY,SAAkB,aAAoE;AACnG,mBAAkB,OAAO;AACvB,UAAM,IAAI,OAAO,KAAK;AACtB,UAAM,YAAY,OAAO,KAAK,OAAO;AACrC,UAAM,cAAc,OAAO,KAAK,CAAC,EAAE,KAAK,UAAQ,CAAC,UAAU,SAAS,IAAI,CAAC;AACzE,QAAI,aAAa;AACf,YAAM,eACJ,SACA,OACA,QACA,4BAA4B,mBAAmB,aACjD;AAAA,IACF;AAIA,UAAM,YAAY,UAAU,KAAK,cAAY;AAC3C,YAAM,iBAAiB,QAAQ;AAC/B,aAAQ,eAAe,KAAK,SAAS,OAAO,KAAK,CAAC,EAAE,eAAe,QAAQ;AAAA,IAC7E,CAAC;AACD,QAAI,WAAW;AACb,YAAM,eACJ,SACA,EAAE,YACF,GAAG,UAAU,aACb,0BAA0B,kBAAkB,eAC5C,iBAAiB,QAAQ,QAAQ,UAAU,EAAE,OAAO,CAAC,KACrD,GACF;AAAA,IACF;AAEA,UAAM,UAAU,QAAQ,KAAK,IACzB,CAAC,KAAK,QAAQ,OAAO,OAAO,KAAK,EAAE,CAAC,MAAM,QAAQ,KAAK,KAAK,EAAE,CAAC,IAC/D,CAAC,KAAK,QAAQ;AACd,YAAM,SAAS,QAAQ;AACvB,UAAI,OAAO,KAAK,SAAS,UAAU,KAAK,CAAC,EAAE,eAAe,GAAG,GAAG;AAC9D,eAAO,OAAO,OAAO,KAAK,CAAC,CAAC;AAAA,MAC9B,OAAO;AACL,eAAO,OAAO,OAAO,KAAK,EAAE,CAAC,MAAM,OAAO,EAAE,MAAM,GAAG,UAAU,KAAK,EAAE,CAAC;AAAA,MACzE;AAAA,IACF;AACF,WAAO,UAAU,OAAO,SAAS,CAAC,CAAC;AAAA,EACrC;AACA,UAAQ,OAAO,MAAM;AACnB,UAAM,QAAQ,OAAO,KAAK,OAAO,EAAE,IACjC,CAAC,QAAQ;AACP,YAAM,MAAM,QAAQ,KAAK,KAAK,SAAS,UAAU,IAC/C,GAAG,SAAS,QAAQ,QAAQ,MAAM,EAAE,QAAQ,KAAK,CAAC,MAClD,GAAG,QAAQ,QAAQ,QAAQ,IAAI;AACjC,aAAO;AAAA,IACT,CACF;AACA,WAAO;AAAA,GAAQ,MAAM,KAAK,OAAO;AAAA;AAAA,EACnC;AACA,SAAO;AACT;AA+BO,eAAgB,OAAO,SAAS,IAAI;AACzC,MAAI,QAAQ,KAAK,KAAK,QAAQ,KAAK;AAAG,WAAO;AAC7C,QAAM,eAAe,OAAO,OAAO,MAAM;AAC3C;AACA,MAAM,OAAO,MAAM;AAYZ,IAAM,SACX,iBAAiB,OAAO,SAAS,IAAI;AACnC,MAAI,QAAQ,KAAK;AAAG,WAAO;AAC3B,MAAI,SAAS,KAAK;AAAG,WAAO;AAC5B,QAAM,eAAe,SAAQ,OAAO,MAAM;AAC5C;AA2DF,qBAAsB,WAAW;AAC/B,iBAAgB,OAAc,SAAS,IAAI;AACzC,eAAW,UAAU,WAAW;AAC9B,UAAI;AACF,eAAO,OAAO,OAAO,MAAM;AAAA,MAC7B,SAAS,GAAP;AAAA,MAAW;AAAA,IACf;AACA,UAAM,eAAe,OAAO,OAAO,MAAM;AAAA,EAC3C;AACA,QAAM,OAAO,MAAM,IAAI,UAAU,IAAI,QAAM,QAAQ,EAAE,CAAC,EAAE,KAAK,KAAK;AAClE,SAAO;AACT;AAGO,IAAM,UAAU;;;AC/YhB,IAAM,cAAc;AACpB,IAAM,eAAe,KAAK;AAC1B,IAAM,cAAc,KAAK;AACzB,IAAM,gBAAgB,KAAK;;;ACQ3B,IAAM,iBAAiB;AAAA,EAC5B,QAAQ;AAAA,EACR,SAAS;AAAA,EACT,SAAS;AACX;AAEO,IAAM,kBAAkB;AACxB,IAAM,yBAAyB;AAC/B,IAAM,yBAAyB;AAC/B,IAAM,gCAAgC;AACtC,IAAM,mCAAmC;AACzC,IAAM,mBAAmB;AAMzB,IAAM,gBAAgB;AACtB,IAAM,gBAAgB;;;ACzBtB,IAAM,eAAe;AACrB,IAAM,mBAAmB;AACzB,IAAM,iBAAiB;AACvB,IAAM,WAAW;AAEjB,IAAM,kBAAkB;AACxB,IAAM,oBAAoB;AAC1B,IAAM,oBAAoB;AAejC,IAAM,gBAAgB,CAAC,UAAU,OAAO,KAAK,MAAM,QAAQ,EAAE,OAAO,OAAK,MAAM,SAAS,GAAG,WAAW,eAAe,MAAM,EAAE;AAE7H,IAAM,QAAgB;AAAA,EACpB,CAAC,kBAAkB,SAAU,OAAO,eAAc,OAAO;AACvD,YAAQ,OAAO,OAAO,KAAK;AAC3B,QAAI,aAAa,cAAc,KAAK;AACpC,QAAI,kBAAiB;AAAwB,oBAAc;AAC3D,UAAM,mBAAmB,MAAM,SAAS,UAAU,eAAc,aAAa,iBAAiB;AAC9F,UAAM,YAAY,qBAAqB,iBAAiB,kBAAkB,UAAU;AACpF,UAAM,mBAAmB,MAAM,OAAO,OAAK,MAAM,gBAAgB,EAAE;AACnE,UAAM,WAAW,MAAM,OAAO,OAAK,MAAM,QAAQ,EAAE;AACnD,UAAM,eAAe,MAAM,OAAO,OAAK,MAAM,YAAY,EAAE;AAC3D,UAAM,oBAAoB,WAAW;AACrC,UAAM,UAAU,oBAAoB;AACpC,UAAM,SAAS,aAAa;AAK5B,UAAM,eAAe,KAAK,KAAK,YAAa,cAAa,iBAAiB;AAC1E,YAAQ,MAAM,cAAc,uBAAuB,kBAAiB,EAAE,cAAc,UAAU,cAAc,kBAAkB,WAAW,QAAQ,SAAS,WAAW,CAAC;AACtK,QAAI,YAAY,cAAc;AAC5B,aAAO;AAAA,IACT;AACA,WAAO,WAAW,SAAS,eAAe,eAAe;AAAA,EAC3D;AAAA,EACA,CAAC,oBAAoB,SAAU,OAAO,eAAc,OAAO;AACzD,YAAQ,OAAO,OAAO,KAAK;AAC3B,UAAM,aAAa,cAAc,KAAK;AACtC,UAAM,aAAa,kBAAiB,yBAAyB,IAAI;AACjE,UAAM,oBAAoB,KAAK,IAAI,MAAM,SAAS,UAAU,eAAc,aAAa,mBAAmB,WAAW,UAAU;AAC/H,UAAM,YAAY,qBAAqB,mBAAmB,mBAAmB,UAAU;AACvF,UAAM,WAAW,MAAM,OAAO,OAAK,MAAM,QAAQ,EAAE;AACnD,UAAM,eAAe,MAAM,OAAO,OAAK,MAAM,YAAY,EAAE;AAC3D,UAAM,UAAU,MAAM;AACtB,UAAM,SAAS,aAAa;AAE5B,YAAQ,MAAM,cAAc,yBAAyB,kBAAiB,EAAE,UAAU,cAAc,WAAW,SAAS,YAAY,OAAO,CAAC;AACxI,QAAI,gBAAgB,WAAW;AAC7B,aAAO;AAAA,IACT;AAGA,WAAO,eAAe,SAAS,YAAY,WAAW;AAAA,EACxD;AAAA,EACA,CAAC,oBAAoB,SAAU,OAAO,eAAc,OAAO;AACzD,UAAM,IAAI,MAAM,gBAAgB;AAAA,EAMlC;AACF;AAEA,IAAO,gBAAQ;AAER,IAAM,WAAgB,QAAQ,GAAG,OAAO,KAAK,KAAK,EAAE,IAAI,OAAK,UAAU,CAAC,CAAC,CAAC;AAc1E,IAAM,uBAAuB,CAAC,MAAc,WAAmB,cAA8B;AAClG,QAAM,kBAAkB,KAAK,IAAI,GAAG,SAAS;AAE7C,SAAO;AAAA,IACL,CAAC,oBAAoB,MAAM;AAEzB,aAAO,KAAK,IAAI,kBAAkB,GAAG,SAAS;AAAA,IAChD;AAAA,IACA,CAAC,kBAAkB,MAAM;AAEvB,YAAM,eAAe,IAAI;AACzB,aAAO,KAAK,IAAI,cAAc,SAAS;AAAA,IACzC;AAAA,EACF,EAAE,MAAM;AACV;;;AC9FO,yBAA0B,EAAE,OAAO,cAAc,UAAU,cAAc;AAC9E,WAAI,OAAO,MAAM,WAAW,YAAY;AACxC,iBAAI,qCAAqC,YACvC,CAAC,sCAAsC,YAAY,cAAc,QAAQ,CAC3E;AACF;AAEO,4BAA6B,SAAiB,cAA8B;AACjF,SAAO,GAAG,SAAS,2BAA2B,kBAAkB;AAClE;AAEO,IAAM,uBAA4B,SAAS;AAAA,EAChD,MAAM;AAAA,EACN,YAAY;AAAA,EACZ,cAAc,SAAS;AAAA,IACrB,CAAC,kBAAkB,SAAS,EAAE,WAAW,OAAO,CAAC;AAAA,IACjD,CAAC,oBAAoB,SAAS,EAAE,WAAW,OAAO,CAAC;AAAA,EACrD,CAAC;AACH,CAAC;AAGM,uBAAwB,cAA+B;AAC5D,QAAM,YAAY,eAAI,kBAAkB;AACxC,QAAM,QAAQ,UAAU,UAAU;AAClC,QAAM,WAAW,MAAM,UAAU;AACjC,QAAM,QAAQ,OAAO,OAAO,CAAC,GAAG,SAAS,KAAK;AAC9C,QAAM,gBAAgB,cAAM,SAAS,KAAK,YAAY,OAAO,SAAS,KAAK,cAAc,KAAK;AAC9F,QAAM,OAAO,KAAK,OAAO,CAAC,KAAK;AAC/B,QAAM,YAAY,cAAM,SAAS,KAAK,YAAY,OAAO,SAAS,KAAK,cAAc,KAAK;AAC1F,UAAQ,MAAM,+BAA+B,4BAA4B,YAAY;AAErF,SAAO,kBAAkB,kBAAkB,cAAc;AAC3D;AAEA,qBAAsB,OAAY,EAAE,MAAM,MAAM,cAAmB;AACjE,QAAM,EAAE,iBAAiB;AACzB,QAAM,WAAW,MAAM,UAAU;AACjC,WAAS,SAAS;AAClB,iBAAI,yBAAyB,iBAAiB,OAAO,cAAc,IAAI;AACvE,kBAAgB,EAAE,OAAO,cAAc,UAAU,WAAW,CAAC;AAC/D;AAIO,IAAM,mBAAmB;AAAA,EAC9B,MAAM;AAAA,EACN,YAAY,KAAK;AAAA,EACjB,cAAe;AAAA,IACb,CAAC,kBAAkB,EAAE,WAAW,KAAK;AAAA,IACrC,CAAC,oBAAoB,EAAE,WAAW,EAAE;AAAA,EACtC;AACF;AAEA,IAAM,YAAoB;AAAA,EACxB,CAAC,yBAAyB;AAAA,IACxB,UAAU;AAAA,IACV,CAAC,WAAW,SAAU,OAAO,EAAE,MAAM,MAAM,cAAc;AACvD,YAAM,EAAE,iBAAiB;AACzB,YAAM,WAAW,MAAM,UAAU;AACjC,eAAS,UAAU,KAAK;AACxB,eAAS,SAAS;AAGlB,YAAM,UAAU,EAAE,MAAM,MAAM,KAAK,aAAa,WAAW;AAC3D,qBAAI,qCAAqC,SAAS,KAAK;AACvD,qBAAI,yBAAyB,iBAAiB,OAAO,UAAU,IAAI;AACnE,sBAAgB,EAAE,OAAO,cAAc,UAAU,WAAW,CAAC;AAAA,IA+B/D;AAAA,IACA,CAAC,eAAe;AAAA,EAClB;AAAA,EACA,CAAC,yBAAyB;AAAA,IACxB,UAAU;AAAA,IACV,CAAC,WAAW,SAAU,OAAO,EAAE,MAAM,MAAM,cAAc;AACvD,YAAM,EAAE,cAAc,gBAAgB;AACtC,YAAM,WAAW,MAAM,UAAU;AACjC,eAAS,SAAS;AAClB,eAAS,UAAU;AACnB,YAAM,cAAc;AAAA,QAClB,GAAG,SAAS,KAAK;AAAA,QACjB;AAAA,QACA,iBAAiB;AAAA,MACnB;AACA,YAAM,UAAU,EAAE,MAAM,aAAa,MAAM,WAAW;AACtD,qBAAI,2CAA2C,SAAS,KAAK;AAC7D,qBAAI,qCAAqC,YACvC,CAAC,8CAA8C,OAAO,CACxD;AACA,sBAAgB,EAAE,OAAO,cAAc,UAAU,WAAW,CAAC;AAAA,IAC/D;AAAA,IACA,CAAC,eAAe;AAAA,EAClB;AAAA,EACA,CAAC,gCAAgC;AAAA,IAC/B,UAAU;AAAA,IACV,CAAC,WAAW,SAAU,OAAO,EAAE,MAAM,MAAM,cAAc;AACvD,YAAM,EAAE,iBAAiB;AACzB,YAAM,WAAW,MAAM,UAAU;AACjC,eAAS,SAAS;AAClB,YAAM,EAAE,SAAS,kBAAkB,SAAS,KAAK;AAGjD,YAAM,UAAU;AAAA,QACd;AAAA,QACA,MAAM,EAAE,CAAC,UAAU,cAAc;AAAA,QACjC;AAAA,MACF;AACA,qBAAI,6CAA6C,SAAS,KAAK;AAC/D,sBAAgB,EAAE,OAAO,cAAc,UAAU,WAAW,CAAC;AAAA,IAC/D;AAAA,IACA,CAAC,eAAe;AAAA,EAClB;AAAA,EACA,CAAC,mCAAmC;AAAA,IAClC,UAAU;AAAA,IACV,CAAC,WAAW,SAAU,OAAO,EAAE,MAAM,MAAM,cAAc;AACvD,YAAM,EAAE,iBAAiB;AACzB,YAAM,WAAW,MAAM,UAAU;AACjC,eAAS,SAAS;AAClB,YAAM,UAAU;AAAA,QACd;AAAA,QACA,MAAM,SAAS,KAAK;AAAA,QACpB;AAAA,MACF;AACA,qBAAI,mDAAmD,SAAS,KAAK;AACrE,sBAAgB,EAAE,OAAO,cAAc,UAAU,WAAW,CAAC;AAAA,IAC/D;AAAA,IACA,CAAC,eAAe;AAAA,EAClB;AAAA,EACA,CAAC,mBAAmB;AAAA,IAClB,UAAU;AAAA,IACV,CAAC,WAAW,SAAU,OAAO,EAAE,MAAM,MAAM,cAAc;AACvD,YAAM,EAAE,iBAAiB;AACzB,YAAM,WAAW,MAAM,UAAU;AACjC,eAAS,SAAS;AAClB,qBAAI,yBAAyB,iBAAiB,OAAO,UAAU,IAAI;AACnE,sBAAgB,EAAE,OAAO,cAAc,UAAU,WAAW,CAAC;AAAA,IAC/D;AAAA,IACA,CAAC,eAAe;AAAA,EAClB;AACF;AAEA,IAAO,oBAAQ;AAER,IAAM,eAAoB,QAAQ,GAAG,OAAO,KAAK,SAAS,EAAE,IAAI,OAAK,UAAU,CAAC,CAAC,CAAC;",
  "names": []
}
